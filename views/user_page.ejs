<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/user_page.css">
    <title><%=site%> : <%=title%></title>
</head>
<body>

    <%- include('partials/nav_bar') %>


    <div id="container">
        <div id="search-bar-container">
            <form action="/u/search" method="post">
                <div class="icon">
                    <svg width="100%" height="100%" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <path d="M8.591,9.298L11.146,11.854C11.342,12.049 11.658,12.049 11.854,11.854C12.049,11.658 12.049,11.342 11.854,11.146L9.298,8.591C10.049,7.683 10.5,6.519 10.5,5.25C10.5,2.352 8.148,0 5.25,0C2.352,0 0,2.352 0,5.25C0,8.148 2.352,10.5 5.25,10.5C6.519,10.5 7.683,10.049 8.591,9.298ZM5.25,1C7.596,1 9.5,2.904 9.5,5.25C9.5,7.596 7.596,9.5 5.25,9.5C2.904,9.5 1,7.596 1,5.25C1,2.904 2.904,1 5.25,1Z"/>
                    </svg>                                       
                </div>
                <input type="text" name="search" id="search" class="txt-search">
                <button type="submit" class="btn-search">Search</button>
            </form>

            <button id="upload-form-open">Add Image</button>
        </div>

        <div id="image-card-container">
            <% row.forEach(image => { %>
                <div class=image-card> 
                    <div class="img-card-header">
                        <p><%= image.NAME %></p>

                        <div id="img-dropdown" class="img-dropdown dropdown">
                            <svg width="100%" height="100%" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                                <path d="M6,8.5C6.276,8.5 6.5,8.724 6.5,9C6.5,9.276 6.276,9.5 6,9.5C5.724,9.5 5.5,9.276 5.5,9C5.5,8.724 5.724,8.5 6,8.5ZM6,5.5C6.276,5.5 6.5,5.724 6.5,6C6.5,6.276 6.276,6.5 6,6.5C5.724,6.5 5.5,6.276 5.5,6C5.5,5.724 5.724,5.5 6,5.5ZM6,2.5C6.276,2.5 6.5,2.724 6.5,3C6.5,3.276 6.276,3.5 6,3.5C5.724,3.5 5.5,3.276 5.5,3C5.5,2.724 5.724,2.5 6,2.5Z"/>
                            </svg>
                            
                            <div id="img-dropdown-menu" class=" img-dropdown-menu dropdown-menu">
                                <ul class="menu-items">
                                    <li class="menu-item">
                                        <button class="share" value="<%= image.ID %>">Share</button>
                                    </li>

                                    <li class="edit menu-item">
                                        <button class="update" value="<%= image.ID %>">Edit</button>
                                    </li>
                                </ul>
                            </div>
                        </div> 
                    </div>
            
                    <div class="img-container-container">
                        <div class="img-container">
                            <img class="img" src=<%= image.LINK %> alt="">
                        </div>
    
                        <div class="img-info">
                            <p>Geolocation      : <%= image.GEOLOCATION %></p>
                            <p>Tags             : <%= image.TAGS %></p>
                            <p>Captured Date    : <%= image.CAPTURED_DATE %></p>
                            <p>Captured By      : <%= image.CAPTURED_BY %></p>
                        </div>
                    </div>

                    <div class="image-card-button-container">
                        <button class=btn-image onclick="window.location.href='<%= image.LINK %>'">
                            <span>
                                <svg width="100%" height="100%" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                                    <path d="M5.5,10.293L0.854,5.646C0.658,5.451 0.342,5.451 0.146,5.646C-0.049,5.842 -0.049,6.158 0.146,6.354L5.646,11.854C5.842,12.049 6.158,12.049 6.354,11.854L11.854,6.354C12.049,6.158 12.049,5.842 11.854,5.646C11.658,5.451 11.342,5.451 11.146,5.646L6.5,10.293L6.5,0.5C6.5,0.224 6.276,-0 6,0C5.724,0 5.5,0.224 5.5,0.5L5.5,10.293Z"/>
                                </svg>                                                       
                            </span>
                            Download
                        </button>
                        <form action="/u/delete" method="post" class="delete-form">
                            
            
                            <button class="btn-image" type="submit" name="delete" id="" value="<%=image.ID%>">
                                <span>
                                    <svg width="100%" height="100%" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                                        <path d="M3,2L1,2C0.724,2 0.5,2.224 0.5,2.5C0.5,2.776 0.724,3 1,3L1.5,3L1.5,9.5C1.5,10.881 2.619,12 4,12C5.222,12 6.778,12 8,12C9.381,12 10.5,10.881 10.5,9.5L10.5,3L11,3C11.276,3 11.5,2.776 11.5,2.5C11.5,2.224 11.276,2 11,2L9,2L9,1.5C9,1.102 8.842,0.721 8.561,0.439C8.279,0.158 7.898,-0 7.5,0C6.629,0 5.371,-0 4.5,0C4.102,-0 3.721,0.158 3.439,0.439C3.158,0.721 3,1.102 3,1.5L3,2ZM9.5,3L2.5,3L2.5,9.5C2.5,10.328 3.172,11 4,11C4,11 8,11 8,11C8.828,11 9.5,10.328 9.5,9.5L9.5,3ZM8.001,2L8,1.5C8,1.367 7.947,1.24 7.854,1.146C7.76,1.053 7.633,1 7.5,1L4.5,1C4.367,1 4.24,1.053 4.146,1.146C4.053,1.24 4,1.367 4,1.5L4,2L8.001,2Z"/>
                                    </svg>                                                                                           
                                </span>
                                Delete
                            </button>
                        </form>
                    </div>

                </div>
            
            <% }); %>
        </div>
    </div>

    <%- include('partials/upload_form') %>

    <%- include('partials/share_form') %>

    <%- include('partials/update_form') %>

    <script src="/dark_mode.js"></script>
    <script type="text/javascript">
        console.log('<%=title%>')

        document.querySelector('#upload-form-close').addEventListener('click', (e) => {
            document.querySelector('#upload-form-container').style.display = 'none'
        })

        if('<%= input_err.length %>' != '0'){
            window.addEventListener('load', (e) => {
                document.querySelector('#upload-form-container').style.display = 'flex';
            })
        }

        document.querySelector('#upload-form-open').addEventListener('click', (e) => {
            document.querySelector('#upload-form-container').style.display = 'flex';
        })

        document.querySelector('.btn-browse').addEventListener('click', (e) => {
            const file = document.querySelector('#file')
            const file_name = document.querySelector('.file-name')


            file_name.innerHTML = file.value()
        })

        var user_dropdown = document.querySelector('#user-dropdown')
        var user_dropdown_menu = document.querySelector('#user-dropdown-menu')

        user_dropdown.addEventListener('click', (e) => {
            if(!e.target.matches('.dropdown')){
                return
            }
            if(e.target.matches('#btn-sign-out')){
                user_dropdown_menu.classList.toggle('active') 
            }
            user_dropdown_menu.classList.toggle('active')
            console.log(e.target)
             
            user_dropdown.classList.toggle('active')
        })

        var img_dropdown = document.getElementsByClassName('img-dropdown')
        var img_dropdown_menu = document.getElementsByClassName('img-dropdown-menu')

        Array.prototype.forEach.call(img_dropdown, (dropdown) => {
            dropdown.addEventListener('click', (e) => {
                if(!e.target.matches('.dropdown')){
                    return
                }
                e.target.classList.toggle('active')

                e.target.childNodes[3].classList.toggle('active')

                e.target.childNodes[3].childNodes[1].childNodes[1].childNodes[1].addEventListener('click', () => {
                    dropdown.classList.toggle('active')
                })
            })
        })

        console.log(img_dropdown)

        document.querySelector('#share-form-close').addEventListener('click', () => {
            document.querySelector('#share-form-container').style.display = 'none'
        })

        var form_share = document.querySelector('#form-share')

        Array.prototype.forEach.call(document.getElementsByClassName('share'), (share) => {
            share.addEventListener('click', (e) => {
                var img = e.target

                // console.log(e.target)

                document.querySelector('#share-form-container').style.display = 'flex'

                form_share.setAttribute('action', '/u/share/' + img.value.toString())
            })
        })

        document.querySelector('#update-form-close').addEventListener('click', () => {
            document.querySelector('#update-form-container').style.display = 'none'
        })

        var form_update = document.querySelector('#form-update')

        Array.prototype.forEach.call(document.getElementsByClassName('update'), (share) => {
            share.addEventListener('click', (e) => {
                var img = e.target

                // console.log(e.target)

                document.querySelector('#update-form-container').style.display = 'flex'

                form_update.setAttribute('action', '/u/home/update/' + img.value.toString())
            })
        })

        var img = document.getElementsByClassName('img')

        Array.prototype.forEach.call(img, (element) => {
            element.onload = () => {
                element.style.display = 'block'

                console.log(element.closest('.image-card'))

                element.closest('.image-card').style.animation = 'none'
            }
        })

        var f_input = document.querySelector('#file-input')

        f_input.addEventListener('change', (e) => {
            var f_name = document.querySelector('.file-name')

            f_name.innerHTML = f_input.value.split( '\\' ).pop()
        })
    </script>
</body>
</html>